---
import type { CollectionEntry } from "astro:content";
import TableOfContents from "./table-of-contents.astro";
import type { MarkdownHeading } from "astro";

export interface Props {
    entry: CollectionEntry<"blog">;
    headings: MarkdownHeading[];
}

const { entry, headings } = Astro.props;
const { title } = entry.data;
const { updatedAt, createdAt } = entry.data;
const date = new Date(createdAt).toLocaleDateString("es-MX", {
    year: "numeric",
    month: "short",
    day: "numeric",
});

const minutes = Math.ceil(entry.body.split(" ").length / 200);
const readingTime = minutes > 1 ? `${minutes} minutos` : "1 minuto";

const isUpdated = updatedAt.getTime() !== createdAt.getTime();
const updatedDate = new Date(updatedAt).toLocaleDateString("es-MX", {
    year: "numeric",
    month: "short",
    day: "numeric",
});
---

<article>
    <header>
        <h1>{title}</h1>
        <div class="meta">
            <div class="info">
                <span>{date}</span>
                <span> / </span>
                <span>{readingTime}</span>
            </div>
            {
                isUpdated && (
                    <time datetime={updatedAt}>
                        Ultima actualizaci√≥n: {updatedDate}
                    </time>
                )
            }
        </div>
    </header>
    <slot />
</article>
<TableOfContents headings={headings} />

<style>
    h1 {
        font-size: 2em;
        font-weight: 600;
        text-wrap: initial;
    }
    article {
        display: grid;
        gap: 1em;
        margin-top: 4em;
    }
    :global(h1, h2, h3, h4, h5, h6) {
        scroll-margin-top: 3em;
    }
    h1 {
        margin-top: 3em;
    }
    .meta {
        margin-top: 1em;
        margin-bottom: 2em;
    }
    .info {
        color: var(--foreground-color-paragraph);
    }
    .meta {
        display: grid;
        gap: 1em;
        grid-auto-flow: column;
        align-items: center;
        justify-content: flex-start;
    }
    time {
        color: var(--primary-color);
        background-color: var(--background-color-emphasis);
        padding: 0.125em 0.25em;
        border-radius: 0.25em;
    }
</style>
